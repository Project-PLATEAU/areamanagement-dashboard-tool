# GEOSERVER レイヤセットアップ手順

1. workspaceを新規作成
    Name及びName Space URIは下記を指定
    ```
    workspace
    ```
2. workspaceにPostGISのストアを新規作成

3. 各レイヤを "レイヤ>リソース新規追加>SQLビューを新規作成" から追加

4. エリマネ活動のレイヤを下記の条件で作成

    - 名称
        ```
        activity_wfs
        ```
    - SQLステートメント
        ```
        geoserver_view_activity_wfs.sqlの内容を貼り付け
        ```
    
    - SQLビューパラメータ
        | ユーザ名 | デフォルト値 | 正規表現を検証 |
        | - | - | - |
        | user_id | -1 | ```^-?[0-9]+$``` |
    
    - 属性
        | ユーザ名 | 種類 | SRID |
        | - | - | - |
        | activity_id | Integer |  |
        | parent_activity_id | Integer |  |
        | activity_type | Integer |  |
        | participants_count | Long |  |
        | height | Double |  |
        | geom | Geometry | 3857 |
        | activity_name | String |  |
    
    ※範囲短径は表示エリアに合わせて設定ください。
    
    ※タイルキャッシングはＯＦＦにしてください。
    
    - サンプルデータ参考設定値 - ネイティブの範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 330,675.962 | 3,783,680.685 | 379,323.484 | 4,116,162.323 |
    
    - サンプルデータ参考設定値 - 緯度経度範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 139.16267798 | 34.1803683 | 139.64046902 | 37.18411287 |
    
5. イベント活動のレイヤを下記の条件で作成

    - 名称
        ```
        event_wfs
        ```
    - SQLステートメント
        ```
        geoserver_view_event_wfs.sqlの内容を貼り付け
        ```
    
    - SQLビューパラメータ
        | ユーザ名 | デフォルト値 | 正規表現を検証 |
        | - | - | - |
        | user_id | -1 | ```^-?[0-9]+$``` |
    
    - 属性
        | ユーザ名 | 種類 | SRID |
        | - | - | - |
        | activity_id | Integer |  |
        | parent_activity_id | Integer |  |
        | activity_type | Integer |  |
        | participants_count | Long |  |
        | height | Double |  |
        | geom | Geometry | 3857 |
        | activity_name | String |  |

    ※範囲短径は表示エリアに合わせて設定ください。
    
    ※タイルキャッシングはＯＦＦにしてください。
    
    - サンプルデータ参考設定値 - ネイティブの範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 330,675.962 | 3,783,680.685 | 379,323.484 | 4,116,162.323 |
    
    - サンプルデータ参考設定値 - 緯度経度範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 139.16267798 | 34.1803683 | 139.64046902 | 37.18411287 |

6. 投稿レイヤのレイヤを下記の条件で作成

    - 名称
        ```
        post
        ```
    - SQLステートメント
        ```
        geoserver_view_post.sqlの内容を貼り付け
        ```
    
    - SQLビューパラメータ
        | ユーザ名 | デフォルト値 | 正規表現を検証 |
        | - | - | - |
        | user_id | -1 | ```^-?[0-9]+$``` |
        | layer_id | -1 | ```^-?[0-9]+$``` |
        | label_item | item_1 | ```[^;']+``` |
    
    - 属性
        | ユーザ名 | 種類 | SRID |
        | - | - | - |
        | feature_id | Integer |  |
        | layer_id | Integer |  |
        | parent_feature_id | Integer |  |
        | height | Double |  |
        | geom | Geometry | 3857 |
        | item_name | String |  |
    
    ※範囲短径は表示エリアに合わせて設定ください。
    
    ※タイルキャッシングはＯＦＦにしてください。
    
    - サンプルデータ参考設定値 - ネイティブの範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 330,675.962 | 3,783,680.685 | 379,323.484 | 4,116,162.323 |
    
    - サンプルデータ参考設定値 - 緯度経度範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 139.16267798 | 34.1803683 | 139.64046902 | 37.18411287 |

7. 歩行者空間ネットワークのレイヤを下記の条件で作成
    
    ※事前にshapeからDBへの取り込みが必須のレイヤです。詳細は構築手順書を参照。
    
    - 名称
        ```
        link_3d
        ```
    - SQLステートメント
        ```
        geoserver_view_link_3d.sqlの内容を貼り付け
        ```
    - Styleは下記を指定
        ```
        geoserver_style_link_3d.sld
        ```
    
    ※属性については「ジオメトリタイプとSRIDを推測」にチェックを入れて再読み込みを行ってください。
    
    ※範囲短径は表示エリアに合わせて設定ください。
    
    ※タイルキャッシングはＯＦＦにしてください。
    
    - サンプルデータ参考設定値 - ネイティブの範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | -5,941.1448450905655 | -32,752.92953103013 | -4,887.43269534964 | -30,663.72306582538 |
    
    - サンプルデータ参考設定値 - 緯度経度範囲矩形
    
        | 最小X | 最小Y | 最大X | 最大Y |
        | - | - | - | - |
        | 139.76766226670279 | 35.70476483450292 | 139.77932228682687 | 35.72360202983433 |

8. 町丁目界(指定)のレイヤを下記の条件で作成
    
    
    ※事前にshapeからDBへの取り込みが必須のレイヤです。
   
   - 名称
     
     ```Text
     chochomokukai_part
     ```
   
   - SQLステートメント
     
     ```Text
     geoserver_settings/geoserver_view_chochomokukai_part.sqlの内容を貼り付け
     ```
   
   - Styleは下記を指定
     
     ```Text
     geoserver_settings/geoserver_style_chochomokukai_part.sld
     ```
   
   - SQLビューパラメータ
     
     | ユーザ名   | デフォルト値 | 正規表現を検証      |
     | ------ | ------ | ------------ |
     | s_area | -1     | ```[^;']+``` |
   
   - 属性
     
     | ユーザ名   | 種類       | SRID |
     | ------ | -------- | ---- |
     | geom   | Geometry | 6668 |
     | 市区名    | String   |      |
     | エリアマネジメント団体 | String   |      |
     
     ※サンプルデータの場合SRIDは「6668」となります。それ以外は環境に合わせて変更してください。
     
     ※範囲短径は表示エリアに合わせて設定ください。
     
     ※タイルキャッシングはＯＦＦにしてください。
   
   - サンプルデータ参考設定値 - ネイティブの範囲矩形
     
     | 最小X                | 最小Y               | 最大X               | 最大Y               |
     | ------------------ | ----------------- | ----------------- | ----------------- |
     | 139.76977952104212 | 35.70262371462337 | 139.7854396102138 | 35.72058421683766 |
   
   - サンプルデータ参考設定値 - 緯度経度範囲矩形
     
     | 最小X                | 最小Y               | 最大X               | 最大Y               |
     | ------------------ | ----------------- | ----------------- | ----------------- |
     | 139.76977952104212 | 35.70262371462337 | 139.7854396102138 | 35.72058421683766 |